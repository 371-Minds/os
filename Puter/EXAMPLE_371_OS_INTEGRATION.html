<!DOCTYPE html>
<html>
<head>
    <title>371 OS Puter.js Integration Example</title>
    <script src="https://js.puter.com/v2/"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        #output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            min-height: 50px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .section {
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>371 OS Puter.js Integration Example</h1>
        <p>This example demonstrates how Puter.js integrates with the 371 OS autonomous agent operating system.</p>
    </div>

    <div class="container section">
        <h2>Authentication</h2>
        <button id="signInBtn">Sign In with Puter</button>
        <button id="signOutBtn" disabled>Sign Out</button>
        <button id="getUserBtn" disabled>Get User Info</button>
        <div id="authOutput"></div>
    </div>

    <div class="container section">
        <h2>AI Capabilities</h2>
        <textarea id="promptInput" placeholder="Enter your AI prompt here...">Explain how 371 OS revolutionizes AI agent coordination in 3 sentences.</textarea>
        <select id="modelSelect">
            <option value="gpt-5-nano">GPT-5 Nano</option>
            <option value="claude-sonnet-4">Claude Sonnet 4</option>
            <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
        </select>
        <button id="chatBtn">Chat with AI</button>
        <button id="streamChatBtn">Stream Chat Response</button>
        <div id="aiOutput"></div>
    </div>

    <div class="container section">
        <h2>Cloud Storage</h2>
        <input type="text" id="fileNameInput" placeholder="Enter file name (e.g., agent-data.json)" value="agent-data.json">
        <textarea id="fileContentInput" placeholder="Enter file content...">{"agentId": "371-os-test-agent", "timestamp": "2025-01-01T00:00:00Z", "data": "This is test data from 371 OS"}</textarea>
        <button id="writeFileBtn">Write File</button>
        <button id="readFileBtn">Read File</button>
        <button id="listFilesBtn">List Files</button>
        <div id="storageOutput"></div>
    </div>

    <div class="container section">
        <h2>Key-Value Store</h2>
        <input type="text" id="keyInput" placeholder="Enter key" value="agent_preference">
        <input type="text" id="valueInput" placeholder="Enter value" value="dark_mode">
        <button id="setKvBtn">Set Key-Value</button>
        <button id="getKvBtn">Get Key-Value</button>
        <button id="listKvBtn">List All Keys</button>
        <div id="kvOutput"></div>
    </div>

    <div class="container section">
        <h2>Website Hosting</h2>
        <input type="text" id="siteNameInput" placeholder="Enter site name" value="my-371-os-site">
        <button id="deploySiteBtn">Deploy Sample Website</button>
        <button id="listSitesBtn">List Deployed Sites</button>
        <div id="hostingOutput"></div>
    </div>

    <script>
        // Authentication functions
        document.getElementById('signInBtn').addEventListener('click', async () => {
            try {
                const result = await puter.auth.signIn();
                document.getElementById('authOutput').innerHTML = `Signed in successfully!<br>User: ${JSON.stringify(result, null, 2)}`;
                document.getElementById('signInBtn').disabled = true;
                document.getElementById('signOutBtn').disabled = false;
                document.getElementById('getUserBtn').disabled = false;
            } catch (error) {
                document.getElementById('authOutput').innerHTML = `Sign in failed: ${error.message}`;
            }
        });

        document.getElementById('signOutBtn').addEventListener('click', () => {
            puter.auth.signOut();
            document.getElementById('authOutput').innerHTML = 'Signed out successfully!';
            document.getElementById('signInBtn').disabled = false;
            document.getElementById('signOutBtn').disabled = true;
            document.getElementById('getUserBtn').disabled = true;
        });

        document.getElementById('getUserBtn').addEventListener('click', async () => {
            try {
                const user = await puter.auth.getUser();
                document.getElementById('authOutput').innerHTML = `User Info:<br>${JSON.stringify(user, null, 2)}`;
            } catch (error) {
                document.getElementById('authOutput').innerHTML = `Failed to get user info: ${error.message}`;
            }
        });

        // AI functions
        document.getElementById('chatBtn').addEventListener('click', async () => {
            const prompt = document.getElementById('promptInput').value;
            const model = document.getElementById('modelSelect').value;
            
            if (!prompt) {
                alert('Please enter a prompt');
                return;
            }
            
            document.getElementById('aiOutput').innerHTML = 'Processing...';
            
            try {
                const response = await puter.ai.chat(prompt, { model: model });
                document.getElementById('aiOutput').innerHTML = response.message.content;
            } catch (error) {
                document.getElementById('aiOutput').innerHTML = `AI request failed: ${error.message}`;
            }
        });

        document.getElementById('streamChatBtn').addEventListener('click', async () => {
            const prompt = document.getElementById('promptInput').value;
            const model = document.getElementById('modelSelect').value;
            
            if (!prompt) {
                alert('Please enter a prompt');
                return;
            }
            
            document.getElementById('aiOutput').innerHTML = 'Streaming response...<br>';
            
            try {
                const response = await puter.ai.chat(prompt, { model: model, stream: true });
                for await (const part of response) {
                    if (part?.text) {
                        document.getElementById('aiOutput').innerHTML += part.text;
                    }
                }
            } catch (error) {
                document.getElementById('aiOutput').innerHTML += `<br>Streaming failed: ${error.message}`;
            }
        });

        // Storage functions
        document.getElementById('writeFileBtn').addEventListener('click', async () => {
            const fileName = document.getElementById('fileNameInput').value;
            const content = document.getElementById('fileContentInput').value;
            
            if (!fileName || !content) {
                alert('Please enter both file name and content');
                return;
            }
            
            document.getElementById('storageOutput').innerHTML = 'Writing file...';
            
            try {
                const file = await puter.fs.write(fileName, content);
                document.getElementById('storageOutput').innerHTML = `File written successfully!<br>Path: ${file.path}<br>Size: ${file.size} bytes`;
            } catch (error) {
                document.getElementById('storageOutput').innerHTML = `Failed to write file: ${error.message}`;
            }
        });

        document.getElementById('readFileBtn').addEventListener('click', async () => {
            const fileName = document.getElementById('fileNameInput').value;
            
            if (!fileName) {
                alert('Please enter a file name');
                return;
            }
            
            document.getElementById('storageOutput').innerHTML = 'Reading file...';
            
            try {
                const blob = await puter.fs.read(fileName);
                const content = await blob.text();
                document.getElementById('storageOutput').innerHTML = `File content:<br><pre>${content}</pre>`;
            } catch (error) {
                document.getElementById('storageOutput').innerHTML = `Failed to read file: ${error.message}`;
            }
        });

        document.getElementById('listFilesBtn').addEventListener('click', async () => {
            document.getElementById('storageOutput').innerHTML = 'Listing files...';
            
            try {
                const items = await puter.fs.readdir('./');
                let output = 'Files in current directory:<br><ul>';
                items.forEach(item => {
                    output += `<li>${item.name} (${item.is_dir ? 'directory' : 'file'})</li>`;
                });
                output += '</ul>';
                document.getElementById('storageOutput').innerHTML = output;
            } catch (error) {
                document.getElementById('storageOutput').innerHTML = `Failed to list files: ${error.message}`;
            }
        });

        // Key-Value Store functions
        document.getElementById('setKvBtn').addEventListener('click', async () => {
            const key = document.getElementById('keyInput').value;
            const value = document.getElementById('valueInput').value;
            
            if (!key || !value) {
                alert('Please enter both key and value');
                return;
            }
            
            document.getElementById('kvOutput').innerHTML = 'Setting key-value pair...';
            
            try {
                await puter.kv.set(key, value);
                document.getElementById('kvOutput').innerHTML = `Key-value pair set successfully!<br>Key: ${key}<br>Value: ${value}`;
            } catch (error) {
                document.getElementById('kvOutput').innerHTML = `Failed to set key-value pair: ${error.message}`;
            }
        });

        document.getElementById('getKvBtn').addEventListener('click', async () => {
            const key = document.getElementById('keyInput').value;
            
            if (!key) {
                alert('Please enter a key');
                return;
            }
            
            document.getElementById('kvOutput').innerHTML = 'Getting value...';
            
            try {
                const value = await puter.kv.get(key);
                document.getElementById('kvOutput').innerHTML = `Value for key "${key}":<br>${value}`;
            } catch (error) {
                document.getElementById('kvOutput').innerHTML = `Failed to get value: ${error.message}`;
            }
        });

        document.getElementById('listKvBtn').addEventListener('click', async () => {
            document.getElementById('kvOutput').innerHTML = 'Listing keys...';
            
            try {
                const keys = await puter.kv.list();
                let output = 'All keys:<br><ul>';
                keys.forEach(key => {
                    output += `<li>${key}</li>`;
                });
                output += '</ul>';
                document.getElementById('kvOutput').innerHTML = output;
            } catch (error) {
                document.getElementById('kvOutput').innerHTML = `Failed to list keys: ${error.message}`;
            }
        });

        // Hosting functions
        document.getElementById('deploySiteBtn').addEventListener('click', async () => {
            const siteName = document.getElementById('siteNameInput').value;
            
            if (!siteName) {
                alert('Please enter a site name');
                return;
            }
            
            document.getElementById('hostingOutput').innerHTML = 'Deploying website...';
            
            try {
                // Create a directory for the website
                const dir = await puter.fs.mkdir(siteName);
                
                // Create index.html
                const htmlContent = `
<!DOCTYPE html>
<html>
<head>
    <title>371 OS Sample Site</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8ff;
        }
        .header {
            background-color: #007bff;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .feature {
            background-color: #e9f7fe;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>371 OS Sample Website</h1>
        <p>Powered by Puter.js and the Revolutionary Autonomous Agent Operating System</p>
    </div>
    
    <div class="content">
        <h2>About This Site</h2>
        <p>This website was automatically deployed using Puter.js integration with 371 OS.</p>
        
        <div class="feature">
            <h3>🚀 Revolutionary Technology</h3>
            <p>Built on the 371 OS autonomous agent operating system with blockchain-based coordination.</p>
        </div>
        
        <div class="feature">
            <h3>☁️ Serverless Infrastructure</h3>
            <p>Hosted on Puter's cloud infrastructure with zero server management.</p>
        </div>
        
        <div class="feature">
            <h3>🤖 AI-Powered</h3>
            <p>Integrated with Claude, GPT, and other AI models through Puter.js.</p>
        </div>
        
        <div class="feature">
            <h3>💰 Cost Efficient</h3>
            <p>Powered by the User Pays Model - developers pay nothing to run this site!</p>
        </div>
        
        <p><strong>Deployment Timestamp:</strong> ${new Date().toISOString()}</p>
    </div>
</body>
</html>`;
                
                await puter.fs.write(`${siteName}/index.html`, htmlContent);
                
                // Deploy the website
                const site = await puter.hosting.create(siteName, siteName);
                
                document.getElementById('hostingOutput').innerHTML = 
                    `Website deployed successfully!<br>` +
                    `URL: <a href="https://${site.subdomain}.puter.site" target="_blank">https://${site.subdomain}.puter.site</a><br>` +
                    `Directory: ${site.root_dir}`;
            } catch (error) {
                document.getElementById('hostingOutput').innerHTML = `Failed to deploy website: ${error.message}`;
            }
        });

        document.getElementById('listSitesBtn').addEventListener('click', async () => {
            document.getElementById('hostingOutput').innerHTML = 'Listing deployed sites...';
            
            try {
                const sites = await puter.hosting.list();
                if (sites.length === 0) {
                    document.getElementById('hostingOutput').innerHTML = 'No deployed sites found.';
                } else {
                    let output = 'Deployed sites:<br><ul>';
                    sites.forEach(site => {
                        output += `<li><a href="https://${site.subdomain}.puter.site" target="_blank">${site.subdomain}</a> (${site.root_dir})</li>`;
                    });
                    output += '</ul>';
                    document.getElementById('hostingOutput').innerHTML = output;
                }
            } catch (error) {
                document.getElementById('hostingOutput').innerHTML = `Failed to list sites: ${error.message}`;
            }
        });

        // Check if user is already signed in
        if (puter.auth.isSignedIn()) {
            document.getElementById('signInBtn').disabled = true;
            document.getElementById('signOutBtn').disabled = false;
            document.getElementById('getUserBtn').disabled = false;
            document.getElementById('authOutput').innerHTML = 'Already signed in';
        }
    </script>
</body>
</html>